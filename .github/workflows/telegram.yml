name: TelegramNotifications


on:
  push:
    branchs:
      - "*"

jobs:
  get_message:
    runs-on: ubuntu-latest
    outputs:
      value: ${{ steps.stringify.outputs.message }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get the message
        id: stringify
        run: |
            export date=$(date '+%d/%m/%Y %H:%M:%S')
            export reponame=${{ github.repository }}
            export who=${{ github.triggering_actor }}
            export event=$(echo ${{ github.event_name }} | tr '[:lower:]' '[:upper:]') 
            echo -e "message=There is a **$event** on [$reponame](https://github.com/${{ github.repository }}), which is triggered by $who at $date" >> "$GITHUB_OUTPUT"
            

  display_branch:
    needs: get_message
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Display current branch name
        run: | 
          echo "${{ needs.get_message.outputs.value }}"
          curl -X POST \
              -H 'Content-Type: application/json' \
              -d '{"chat_id": "5619096601", "text": "${{ needs.get_message.outputs.value }}", "parse_mode": "MarkdownV2"}' \
              https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_API }}/sendMessage 


