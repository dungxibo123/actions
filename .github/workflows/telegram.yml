name: TelegramNotifications


on:
  push:
    branchs:
      - "*"

jobs:
  get_message:
    runs-on: ubuntu-latest
    outputs:
      value: ${{ steps.set_output.outputs.message }}
      test_value: ${{ steps.set_output.value_to_expose }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get the message
        run: |
            export date=$(date '+%d/%m/%Y %H:%M:%S')
            export reponame=${{ github.repository }}
            export who=${{ github.triggering_actor }}
            export event=${{ github.event }}
            echo -e "message=There is a $event on $reponame, which is triggered by $who at $date" >> "$GITHUB_OUTPUT"
            echo "value_to_expose=hello_world" >> "$GITHUB_OUTPUT"
            

  display_branch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Display current branch name
        env:
          SUPER_SECRET: "test"
        run: | 
          echo "${{ needs.get_message.outputs.value }}"
          curl -X POST \
              -H 'Content-Type: application/json' \
              -d '{"chat_id": "5619096601", "text": "${{ needs.get_message.outputs.test_value }}"}' \
              https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_API }}/sendMessage 


